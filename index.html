<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App t·ª´ v·ª±ng</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #fff;
            font-size: 2.5em;
            margin-bottom: 30px;
        }

        .main-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .study-button {
            background-color: #666;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .study-button:hover {
            background-color: #555;
            transform: translateY(-2px);
        }

        .backup-actions {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .backup-button {
            background-color: #27ae60;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .backup-button:hover {
            background-color: #219652;
            transform: translateY(-2px);
        }

        .import-button {
            background-color: #e67e22;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
        }

        .import-button:hover {
            background-color: #d35400;
            transform: translateY(-2px);
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            margin-bottom: 10px;
        }

        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .folder-creation {
            background-color: #111;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #333;
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 20px;
            color: #fff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #333;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #ccc;
        }

        input {
            width: 100%;
            padding: 10px;
            background-color: #222;
            color: #fff;
            border: 1px solid #444;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #0d62d9;
        }

        .folder-list {
            margin-top: 20px;
        }

        .folder-item {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .folder-item:hover {
            background-color: #2a2a2a;
        }

        .folder-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .folder-main {
            flex: 1;
        }

        .folder-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }

        .folder-code {
            font-weight: bold;
            color: #1a73e8;
            font-size: 1.1em;
        }

        .folder-name {
            color: #fff;
            font-weight: 500;
        }

        .folder-stats {
            text-align: right;
            color: #888;
            font-size: 0.9em;
        }

        .total-words {
            margin-bottom: 3px;
        }

        .no-data {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }

        .stats {
            margin-top: 30px;
            padding: 20px;
            background-color: #111;
            border-radius: 10px;
            border: 1px solid #333;
            text-align: center;
        }

        .stat-item {
            margin: 10px 0;
            color: #ccc;
            font-size: 1.1em;
        }

        .stat-number {
            color: #1a73e8;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>App t·ª´ v·ª±ng</h1>
        </header>

        <div class="main-actions">
            <a href="choose.html" class="study-button">Ch·ªçn t·ª´ ƒë·ªÉ h·ªçc</a>
	    <a href="chotyp.html" class="study-button">üéÆ G√µ t·ª´ nghe ti·∫øng Anh</a>
        </div>

        <div class="backup-actions">
            <button class="backup-button" onclick="exportData()">üì§ Xu·∫•t d·ªØ li·ªáu</button>
            <div class="file-input-container">
                <input type="file" id="importFile" class="file-input" accept=".json">
                <button class="import-button">üì• Import d·ªØ li·ªáu</button>
            </div>
        </div>

        <section class="folder-creation">
            <h2 class="section-title">T·∫°o th∆∞ m·ª•c m·ªõi</h2>
            
            <div class="form-group">
                <label for="folderCode">M√£ th∆∞ m·ª•c:</label>
                <input type="text" id="folderCode" placeholder="Nh·∫≠p m√£ th∆∞ m·ª•c">
            </div>
            <div class="form-group">
                <label for="folderName">T√™n th∆∞ m·ª•c:</label>
                <input type="text" id="folderName" placeholder="Nh·∫≠p t√™n th∆∞ m·ª•c">
            </div>
            <button id="addFolderBtn">Th√™m Th∆∞ m·ª•c</button>
        </section>

        <div class="folder-list" id="folderList">
            <!-- Danh s√°ch th∆∞ m·ª•c s·∫Ω hi·ªán ·ªü ƒë√¢y -->
        </div>

        <div class="stats" id="statsContainer">
            <!-- Th·ªëng k√™ s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
        </div>
    </div>

    <script>
        // Kh·ªüi t·∫°o d·ªØ li·ªáu
        function initializeData() {
            if (!localStorage.getItem('folders')) {
                localStorage.setItem('folders', JSON.stringify([]));
            }
            if (!localStorage.getItem('vocabularies')) {
                localStorage.setItem('vocabularies', JSON.stringify([]));
            }
        }

        // L·∫•y danh s√°ch th∆∞ m·ª•c
        function getFolders() {
            return JSON.parse(localStorage.getItem('folders')) || [];
        }

        // L·∫•y danh s√°ch t·ª´ v·ª±ng
        function getVocabularies() {
            return JSON.parse(localStorage.getItem('vocabularies')) || [];
        }

        // L∆∞u danh s√°ch th∆∞ m·ª•c
        function saveFolders(folders) {
            localStorage.setItem('folders', JSON.stringify(folders));
        }

        // Hi·ªÉn th·ªã danh s√°ch th∆∞ m·ª•c
        function displayFolders() {
            const folderList = document.getElementById('folderList');
            const folders = getFolders();
            const vocabularies = getVocabularies();
            const now = Date.now();

            if (folders.length === 0) {
                folderList.innerHTML = '<div class="no-data">Ch∆∞a c√≥ th∆∞ m·ª•c n√†o. H√£y th√™m th∆∞ m·ª•c ƒë·∫ßu ti√™n!</div>';
                return;
            }

            folderList.innerHTML = folders.map(folder => {
                const folderVocabs = vocabularies.filter(v => v.s === folder.code);
                const totalWords = folderVocabs.length;
                
                // T√≠nh t·ª´ c·∫ßn h·ªçc d·ª±a tr√™n tr∆∞·ªùng nt
                const wordsToLearn = folderVocabs.filter(v => {
                    // N·∫øu kh√¥ng c√≥ nt ho·∫∑c nt <= th·ªùi gian hi·ªán t·∫°i -> c·∫ßn h·ªçc
                    return !v.nt || v.nt <= now;
                }).length;

                return `
                    <div class="folder-item" onclick="viewFolder('${folder.code}')">
                        <div class="folder-info">
                            <div class="folder-main">
                                <div class="folder-header">
                                    <div class="folder-code">${folder.code}</div>
                                    <div class="folder-name">${folder.name}</div>
                                </div>
                            </div>
                            <div class="folder-stats">
                                <div class="total-words">${totalWords} t·ª´</div>
                                <div class="words-to-learn">${wordsToLearn} t·ª´ c·∫ßn h·ªçc</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Th√™m th∆∞ m·ª•c m·ªõi
        function addFolder() {
            const folderCode = document.getElementById('folderCode').value.trim();
            const folderName = document.getElementById('folderName').value.trim();

            if (!folderCode || !folderName) {
                alert('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß m√£ v√† t√™n th∆∞ m·ª•c');
                return;
            }

            const folders = getFolders();
            
            // Ki·ªÉm tra tr√πng m√£ ho·∫∑c t√™n
            if (folders.some(folder => folder.code === folderCode)) {
                alert('M√£ th∆∞ m·ª•c ƒë√£ t·ªìn t·∫°i');
                return;
            }

            if (folders.some(folder => folder.name === folderName)) {
                alert('T√™n th∆∞ m·ª•c ƒë√£ t·ªìn t·∫°i');
                return;
            }

            // Th√™m th∆∞ m·ª•c m·ªõi
            folders.push({
                code: folderCode,
                name: folderName
            });

            saveFolders(folders);
            displayFolders();
            displayStats();
            
            // Reset form
            document.getElementById('folderCode').value = '';
            document.getElementById('folderName').value = '';
        }

        // Xem chi ti·∫øt th∆∞ m·ª•c
        function viewFolder(folderCode) {
            window.location.href = `folder.html?folderCode=${folderCode}`;
        }

        // L·∫•y th·ªëng k√™
        function getStats() {
            const folders = getFolders();
            const vocabularies = getVocabularies();
            const now = Date.now();
            
            const totalFolders = folders.length;
            const totalWords = vocabularies.length;
            
            // T√≠nh t·ª´ c·∫ßn h·ªçc d·ª±a tr√™n tr∆∞·ªùng nt
            const wordsToLearn = vocabularies.filter(v => {
                return !v.nt || v.nt <= now;
            }).length;
            
            const learnedWords = vocabularies.filter(v => {
                return v.nt && v.nt > now;
            }).length;

            return {
                totalFolders,
                totalWords,
                wordsToLearn,
                learnedWords
            };
        }

        // Hi·ªÉn th·ªã th·ªëng k√™
        function displayStats() {
            const statsContainer = document.getElementById('statsContainer');
            const stats = getStats();

            statsContainer.innerHTML = `
                <div class="stat-item">T·ªïng th∆∞ m·ª•c: <span class="stat-number">${stats.totalFolders}</span></div>
                <div class="stat-item">T·ªïng t·ª´ v·ª±ng: <span class="stat-number">${stats.totalWords}</span></div>
                <div class="stat-item">T·ª´ c·∫ßn h·ªçc: <span class="stat-number">${stats.wordsToLearn}</span></div>
                <div class="stat-item">T·ª´ ch·ªù nh·∫Øc: <span class="stat-number">${stats.learnedWords}</span></div>
            `;
        }

        // Xu·∫•t d·ªØ li·ªáu ra file JSON
        function exportData() {
            const data = {
                folders: getFolders(),
                vocabularies: getVocabularies(),
                exportTime: new Date().toISOString(),
                version: "1.0"
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `vocabulary-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert(`ƒê√£ xu·∫•t d·ªØ li·ªáu th√†nh c√¥ng!\nT·ªïng: ${data.folders.length} th∆∞ m·ª•c, ${data.vocabularies.length} t·ª´ v·ª±ng`);
        }

        // Import d·ªØ li·ªáu t·ª´ file JSON
        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate d·ªØ li·ªáu
                    if (!data.folders || !data.vocabularies) {
                        alert('File kh√¥ng h·ª£p l·ªá: thi·∫øu d·ªØ li·ªáu folders ho·∫∑c vocabularies');
                        return;
                    }

                    if (!confirm(`S·∫Ω thay th·∫ø to√†n b·ªô d·ªØ li·ªáu hi·ªán t·∫°i b·∫±ng:\n${data.folders.length} th∆∞ m·ª•c\n${data.vocabularies.length} t·ª´ v·ª±ng\n\nTi·∫øp t·ª•c?`)) {
                        return;
                    }

                    // L∆∞u d·ªØ li·ªáu m·ªõi
                    localStorage.setItem('folders', JSON.stringify(data.folders));
                    localStorage.setItem('vocabularies', JSON.stringify(data.vocabularies));

                    alert('Import d·ªØ li·ªáu th√†nh c√¥ng!');
                    displayFolders();
                    displayStats();
                    
                    // Reset file input
                    event.target.value = '';
                } catch (error) {
                    alert('L·ªói khi ƒë·ªçc file JSON: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        // Kh·ªüi ch·∫°y
        document.addEventListener('DOMContentLoaded', function() {
            initializeData();
            displayFolders();
            displayStats();

            // G·∫Øn s·ª± ki·ªán
            document.getElementById('addFolderBtn').addEventListener('click', addFolder);
            document.getElementById('importFile').addEventListener('change', importData);
        });
    </script>
</body>
</html>