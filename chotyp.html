<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·ªçn t·ª´ ƒë·ªÉ g√µ - App t·ª´ v·ª±ng</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #000;
            color: #fff;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
        }

        h1 {
            color: #fff;
            font-size: 2em;
            margin-bottom: 20px;
        }

        .back-button {
            background-color: #666;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            margin-bottom: 20px;
        }

        .back-button:hover {
            background-color: #555;
        }

        .word-list {
            margin-top: 20px;
        }

        .word-item {
            background-color: #222;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .word-item:hover {
            background-color: #2a2a2a;
        }

        .word-content {
            display: flex;
            gap: 15px;
            align-items: center;
            flex: 1;
        }

        .word-en {
            font-weight: bold;
            color: #1a73e8;
            font-size: 1.1em;
            min-width: 120px;
        }

        .word-pronunciation {
            color: #ccc;
            font-size: 0.9em;
            min-width: 100px;
        }

        .word-meaning {
            color: #fff;
            flex: 1;
        }

        .word-level {
            color: #888;
            font-size: 0.9em;
            min-width: 50px;
            text-align: right;
        }

        .no-data {
            text-align: center;
            color: #666;
            padding: 40px;
            font-style: italic;
        }

        .warning-message {
            background-color: #333;
            border: 1px solid #555;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            color: #ff6b6b;
        }

        .study-button {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 20px;
            width: 100%;
        }

        .study-button:hover {
            background-color: #0d62d9;
        }

        .study-button:disabled {
            background-color: #666;
            cursor: not-allowed;
        }

        .hidden {
            display: none;
        }

        .type-level {
            color: #4caf50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéÆ Ch·ªçn t·ª´ ƒë·ªÉ g√µ</h1>
            <a href="index.html" class="back-button">‚Üê Quay l·∫°i</a>
        </header>

        <div id="warningMessage" class="warning-message hidden">
            <!-- Th√¥ng b√°o c·∫£nh b√°o s·∫Ω hi·ªán ·ªü ƒë√¢y -->
        </div>

        <div class="word-list" id="wordList">
            <!-- Danh s√°ch t·ª´ s·∫Ω hi·ªán ·ªü ƒë√¢y -->
        </div>

        <button class="study-button" id="studyButton" disabled>B·∫Øt ƒë·∫ßu g√µ t·ª´</button>
    </div>

    <script>
        // L·∫•y danh s√°ch t·ª´ v·ª±ng
        function getVocabularies() {
            return JSON.parse(localStorage.getItem('vocabularies')) || [];
        }

        // Ki·ªÉm tra t·ª´ c√≥ c·∫ßn √¥n t·∫≠p kh√¥ng (D√ôNG TR∆Ø·ªúNG tnt - type next time)
        function needsTypeReview(vocab) {
            const now = Date.now();
            return now >= (vocab.tnt || 0);
        }

        // L·∫•y t·ª´ v·ª±ng c·∫ßn h·ªçc cho ch·∫ø ƒë·ªô g√µ - L·ªåC T·ª™ TR√ôNG
        function getWordsToType() {
            const allVocabularies = getVocabularies();
            
            let wordsToType = allVocabularies.filter(vocab => needsTypeReview(vocab));

            // L·ªåC B·ªé T·ª™ TR√ôNG - CH·ªà GI·ªÆ L·∫†I 1 T·ª™ CHO M·ªñI T·ª™ TI·∫æNG ANH
            const uniqueWords = new Map();
            wordsToType.forEach(vocab => {
                if (!uniqueWords.has(vocab.w)) {
                    uniqueWords.set(vocab.w, vocab);
                }
            });
            wordsToType = Array.from(uniqueWords.values());

            // S·∫Øp x·∫øp theo ∆∞u ti√™n: tl (type level) th·∫•p tr∆∞·ªõc, c√πng level th√¨ tlt (type last time) c≈© h∆°n tr∆∞·ªõc
            wordsToType.sort((a, b) => {
                const a_tl = a.tl || 0;
                const b_tl = b.tl || 0;
                
                if (a_tl !== b_tl) {
                    return a_tl - b_tl;
                }
                
                // C√πng level th√¨ ∆∞u ti√™n t·ª´ h·ªçc l√¢u h∆°n (tlt nh·ªè h∆°n)
                const a_tlt = a.tlt || 0;
                const b_tlt = b.tlt || 0;
                return a_tlt - b_tlt;
            });

            return wordsToType.slice(0, 10);
        }

        // Ph√°t √¢m t·ª´
        function playWordPronunciation(word) {
            if ('speechSynthesis' in window) {
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                
                console.log('üîä ƒêang ph√°t √¢m:', word);
                speechSynthesis.speak(utterance);
            } else {
                console.log('‚ùå Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ph√°t √¢m thanh');
            }
        }

        // Hi·ªÉn th·ªã danh s√°ch t·ª´ ƒë·ªÉ g√µ
        function displayWordsToType() {
            const wordList = document.getElementById('wordList');
            const warningMessage = document.getElementById('warningMessage');
            const studyButton = document.getElementById('studyButton');

            const wordsToType = getWordsToType();

            // Ki·ªÉm tra s·ªë l∆∞·ª£ng t·ª´
            if (wordsToType.length < 4) {
                warningMessage.innerHTML = `Ch·ªâ c√≥ ${wordsToType.length} t·ª´ ƒë·ªÉ g√µ. C·∫ßn n·∫°p th√™m t·ª´ m·ªõi!`;
                warningMessage.classList.remove('hidden');
                studyButton.disabled = true;
            } else {
                warningMessage.classList.add('hidden');
                studyButton.disabled = false;
            }

            // Hi·ªÉn th·ªã danh s√°ch t·ª´
            if (wordsToType.length === 0) {
                wordList.innerHTML = '<div class="no-data">Kh√¥ng c√≥ t·ª´ n√†o ƒë·ªÉ g√µ</div>';
                return;
            }

            wordList.innerHTML = wordsToType.map(word => {
                const typeLevel = word.tl || 0;
                return `
                    <div class="word-item" onclick="playWordPronunciation('${word.w}')">
                        <div class="word-content">
                            <div class="word-en">${word.w}</div>
                            <div class="word-pronunciation">${word.p || ''}</div>
                            <div class="word-meaning">${word.m || ''}</div>
                        </div>
                        <div class="word-level">
                            <span class="type-level">T-Lv:${typeLevel}</span>
                        </div>
                    </div>
                `;
            }).join('');

            // Hi·ªÉn th·ªã th√¥ng tin s·ªë t·ª´
            studyButton.textContent = `B·∫Øt ƒë·∫ßu g√µ t·ª´ (${wordsToType.length} t·ª´)`;
        }

        // Kh·ªüi ch·∫°y
        document.addEventListener('DOMContentLoaded', function() {
            displayWordsToType();

            // G·∫Øn s·ª± ki·ªán n√∫t Study
            document.getElementById('studyButton').addEventListener('click', function() {
                const selectedWords = getWordsToType();
                
                if (selectedWords.length < 4) {
                    alert('C·∫ßn √≠t nh·∫•t 4 t·ª´ ƒë·ªÉ b·∫Øt ƒë·∫ßu g√µ!');
                    return;
                }
                
                // L∆∞u danh s√°ch t·ª´ ƒë√£ ch·ªçn v√†o localStorage
                localStorage.setItem('selectedTypeWords', JSON.stringify(selectedWords));
                
                // S·ª¨A L·∫†I: Chuy·ªÉn sang trang typwor.html thay v√¨ type.html
                window.location.href = 'typwor.html';
            });
        });

        // T·∫†O D·ªÆ LI·ªÜU TEST T·ª∞ ƒê·ªòNG N·∫æU CH∆ØA C√ì (v·ªõi c√°c tr∆∞·ªùng type)
        setTimeout(() => {
            const existingVocab = getVocabularies();
            if (existingVocab.length === 0) {
                const testData = [
                    {w: "Apple", m: "qu·∫£ t√°o", p: "/Àà√¶p.…ôl/", tl: 1, tlt: Date.now() - 86400000, tnt: Date.now()},
                    {w: "Computer", m: "m√°y t√≠nh", p: "/k…ômÀàpjuÀê.t…ôr/", tl: 1, tlt: Date.now() - 172800000, tnt: Date.now()},
                    {w: "Hello", m: "xin ch√†o", p: "/heÀàl…ô ä/", tl: 0, tlt: 0, tnt: 0},
                    {w: "Book", m: "s√°ch", p: "/b äk/", tl: 2, tlt: Date.now() - 259200000, tnt: Date.now()},
                    {w: "Pen", m: "b√∫t", p: "/pen/", tl: 1, tlt: Date.now() - 86400000, tnt: Date.now()}
                ];
                localStorage.setItem('vocabularies', JSON.stringify(testData));
                console.log('‚úÖ ƒê√£ t·∫°o d·ªØ li·ªáu test t·ª± ƒë·ªông cho ch·∫ø ƒë·ªô g√µ');
                displayWordsToType();
            }
        }, 1000);
    </script>
</body>
</html>